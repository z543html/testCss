<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://cdn.bootcdn.net/ajax/libs/vConsole/3.9.0/vconsole.min.js"></script>
    <script>
        // init vConsole
        var vConsole = new VConsole();
        console.log('Hello world');
    </script>
</head>
<body>
  <div>测试</div>
  <button onclick="toApp()">唤起</button>
  <script>
    function toApp() {
      var url = 'zhsh://'+'gd'+'.10086' + '.cn';
      var OldUrl = 'gmcchhapp://main'
      location.href = url + '?vtime=' + new Date().getTime();
      console.log('ios_new_url',url)
      handleJumpAppTimeout(function () {
        console.log('ios_old_url',OldUrl)
        location.href = OldUrl + '?vtime=' + new Date().getTime();
      })

    };
    function handleJumpAppTimeout (fn) {
      var timeOut = 2000;
      var timer,start = new Date().getTime();
      timer = setTimeout(function (){
          let end = new Date().getTime();
          if(end - start > timeOut + 1000){
            console.log('clearTimeout')
            clearTimeout(timer);
          }else {
            var hidden = window.document.hidden || window.document.mozHidden || window.document.msHidden ||window.document.webkitHidden;
            console.log('setTimeout1')
            if(typeof hidden =="undefined" || hidden == false){
              console.log('setTimeout2')
              if (fn && typeof fn === 'function') {
                fn();
              }
            }
          };
      },timeOut);
    },
  </script>
</body>
</html>