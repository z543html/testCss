<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://cdn.bootcdn.net/ajax/libs/vConsole/3.9.0/vconsole.min.js"></script>
    <script>
        // init vConsole
        var vConsole = new VConsole();
        console.log('Hello world');
    </script>
    
</head>
<body>
  <div>测试</div>
  <button onclick="toApp()">模拟唤起</button>  说明：先location调用新版，延时2秒后location调用旧版
  <br>
  <br>
  <button onclick="toApp1()">直接location唤起新版</button> 
  <br>
  <br>
  <button onclick="toApp2()">直接location唤起旧版</button> 
  <br>
  <br>
  <button onclick="toApp3()">延时2秒后location唤起旧版</button>
  <br>
  <br>
  <br>
  <button onclick="toAppb()">唤起top</button> 说明：先新，延时2秒后top.location旧版
  <br>
  <br>
  <button onclick="toAppc()">唤起self</button> 说明：先新，延时2秒后self.location旧版
  <br>
  <br>
  <button onclick="toAppd()">唤起iframe</button> 说明：先新，延时2秒后iframe旧版
  <br>
  <br>
  <button onclick="toAppf()">唤起click'a'标签</button> 说明：先新，延时2秒后a标签旧版
  <br>
  <br>
  <button onclick="toAppg()">唤起replace</button> 说明：先新，延时2秒后location.replace
  <br>
  <br>
  <button onclick="toAppj()">单独唤起click'a'标签旧版</button> 说明：单独a标签唤起旧版
  <br>
  <br>
  <button onclick="toApph()">全部唤起click'a'标签</button> 说明：先新'a'标签，延时2秒后'a'标签
  <br>
  <br>
  <button onclick="toAppi()">先唤起click'a'标签，后location旧版</button> 说明：先新'a'标签，延时2秒后location旧版
  <br>
  <script>
    var url = 'zhsh://'+'gd'+'.10086' + '.cn';
    var OldUrl = 'gmcchhapp://main';
    console.log('window.location.href',window.location)
    // 先新，延时后旧
    function toApp() {
      toApp1();
      toApp3()
    };
    // 新
    function toApp1() {
      toJump(url);
    }
    // 旧
    function toApp2() {
      toJump(OldUrl);
    }
    // 延时2秒旧
    function toApp3() {
      setTimeout(function (){
        toApp2();
      },2000);
    }
    // 先新，延时2秒后top.location
    function toAppb() {
      toApp1()
      setTimeout(function (){
        toJumpTop(OldUrl);
      },2000);
    };
    function toAppc() {
      toApp1()
      setTimeout(function (){
        toJumpSelf(OldUrl);
      },2000);
    };
    function toAppd() {
      toApp1()
      setTimeout(function (){
        handleJumpAppAddIframe(OldUrl);
      },2000);
    };
    function toAppf() {
      toApp1()
      setTimeout(function (){
        evokeByTagA(OldUrl);
      },2000);
    };
    function toAppg() {
      toApp1()
      setTimeout(function (){
        toJumpReplace(OldUrl);
      },2000);
    };
    function toApph() {
      evokeByTagA(url);
      setTimeout(function (){
        evokeByTagA(OldUrl);
      },2000);
    };
    function toAppi() {
      evokeByTagA(url);
      setTimeout(function (){
        toJump(OldUrl);
      },2000);
    };
    function toAppj() {
      evokeByTagA(OldUrl);
    };

    // a标签
    function evokeByTagA(uri) {
      var tagA = document.createElement('a');
      tagA.setAttribute('href', uri);
      tagA.style.display = 'none';
      document.body.append(tagA);
      tagA.click();
      window.setTimeout(function() {
        document.body.removeChild(tagA);
      }, 3000)
    }
    // iframe
    function handleJumpAppAddIframe (url) {
      var ifr = document.createElement('iframe');
      ifr.src = url;
      ifr.style.display = 'none';
      document.body.appendChild(ifr);
    };
    // location.href
    function toJump(url) {
      url = url + '?vtime=' + new Date().getTime();
      console.log('jump_url',url)
      location.href = url;
    }
    // top.location
    function toJumpTop(url) {
      url = url + '?vtime=' + new Date().getTime();
      console.log('jump_url',url)
      top.location = url;
    }
    // self.location
    function toJumpSelf(url) {
      url = url + '?vtime=' + new Date().getTime();
      console.log('jump_url',url)
      self.location = url;
    }
    // location.replace
    function toJumpReplace(url) {
      url = url + '?vtime=' + new Date().getTime();
      console.log('jump_url',url)
      window.location.replace = url;
    }
  </script>
</body>
</html>